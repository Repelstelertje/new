---
import { PROVINCES, provinceToSlug } from "../lib/provinces";

const TIP_LINKS = [
  { href: "/datingtips/veilig-daten-18-plus/", label: "Veilig daten (18+)" },
  { href: "/datingtips/het-eerste-bericht/", label: "Het eerste bericht" },
  { href: "/datingtips/afspreken-dos-and-donts/", label: "Afspreken: do’s & don’ts" },
];
---

<header class="bg-white border-b border-neutral-200 text-neutral-900 sticky top-0 z-50">
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[60] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600 bg-white px-3 py-2 rounded-md shadow"
  >
    Sla over naar hoofdinhoud
  </a>

  <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-4">
    <!-- Brand -->
    <a href="/" class="inline-flex items-center gap-3 rounded-md focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600">
      <span class="text-xl font-semibold">OproepjesNederland</span>
    </a>

    <!-- Nav -->
    <nav aria-label="Hoofdnavigatie" class="relative">
      <ul class="flex items-center gap-3">
        <!-- Provinces -->
        <li class="relative">
          <button
            id="btn-provinces"
            class="inline-flex items-center rounded-full px-4 py-2 text-sm font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="menu-provinces"
            data-menu-button="provinces"
            type="button"
          >
            Provincies
            <span aria-hidden="true" class="ml-1">▾</span>
          </button>

          <div
            id="menu-provinces"
            role="menu"
            aria-labelledby="btn-provinces"
            class="invisible opacity-0 pointer-events-none absolute left-0 top-[calc(100%+10px)] w-[46rem] max-w-[90vw] rounded-2xl border border-neutral-200 bg-white p-4 shadow-xl transition-opacity duration-150"
            data-menu-panel="provinces"
          >
            <div class="grid grid-cols-3 gap-2">
              {PROVINCES.map((name) => {
                const slug = provinceToSlug(name);
                const href = `/dating-${slug}/`;
                return (
                  <a
                    role="menuitem"
                    href={href}
                    class="block rounded-lg px-3 py-2 text-base font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                    data-close-on-click
                  >
                    {name}
                  </a>
                );
              })}
            </div>
          </div>
        </li>

        <!-- Datingtips -->
        <li class="relative">
          <button
            id="btn-tips"
            class="inline-flex items-center rounded-full px-4 py-2 text-sm font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="menu-tips"
            data-menu-button="tips"
            type="button"
          >
            Datingtips
            <span aria-hidden="true" class="ml-1">▾</span>
          </button>

          <div
            id="menu-tips"
            role="menu"
            aria-labelledby="btn-tips"
            class="invisible opacity-0 pointer-events-none absolute left-0 top-[calc(100%+10px)] w-[24rem] max-w-[90vw] rounded-2xl border border-neutral-200 bg-white p-2 shadow-xl transition-opacity duration-150"
            data-menu-panel="tips"
          >
            <ul class="flex flex-col">
              {TIP_LINKS.map((t) => (
                <li>
                  <a
                    role="menuitem"
                    href={t.href}
                    class="block rounded-lg px-3 py-2 text-base font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                    data-close-on-click
                  >
                    {t.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </li>

        <!-- Socials (icons only) -->
        <li class="relative">
          <button
            id="btn-socials"
            class="inline-flex items-center rounded-full px-4 py-2 text-sm font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="menu-socials"
            data-menu-button="socials"
            type="button"
          >
            Socials
            <span aria-hidden="true" class="ml-1">▾</span>
          </button>

          <div
            id="menu-socials"
            role="menu"
            aria-labelledby="btn-socials"
            class="invisible opacity-0 pointer-events-none absolute right-0 top-[calc(100%+10px)] w-[14rem] max-w-[90vw] rounded-2xl border border-neutral-200 bg-white p-3 shadow-xl transition-opacity duration-150"
            data-menu-panel="socials"
          >
            <ul class="flex items-center justify-between gap-3">
              <li>
                <a
                  role="menuitem"
                  href="https://facebook.com/contactoproepjes"
                  target="_blank"
                  rel="noopener nofollow"
                  class="inline-flex items-center gap-2 rounded-lg p-2 hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                  aria-label="Volg ons op Facebook"
                  data-close-on-click
                >
                  <img src="/img/fb.png" alt="" width="28" height="28" class="block" />
                </a>
              </li>
              <li>
                <a
                  role="menuitem"
                  href="https://www.instagram.com/oproepjes_nederland"
                  target="_blank"
                  rel="noopener nofollow"
                  class="inline-flex items-center gap-2 rounded-lg p-2 hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                  aria-label="Volg ons op Instagram"
                  data-close-on-click
                >
                  <img src="/img/ig.png" alt="" width="28" height="28" class="block" />
                </a>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Menu control script -->
  <script>
    (function () {
      /** Only one menu open at a time */
      let open = /** @type {'provinces'|'tips'|'socials'|null} */ (null);

      const btns = document.querySelectorAll("[data-menu-button]");
      const panels = document.querySelectorAll("[data-menu-panel]");

      function setOpen(id) {
        open = id;
        btns.forEach((b) => {
          const key = b.getAttribute("data-menu-button");
          const expanded = key === open;
          b.setAttribute("aria-expanded", expanded ? "true" : "false");
        });
        panels.forEach((p) => {
          const key = p.getAttribute("data-menu-panel");
          const visible = key === open;
          p.classList.toggle("invisible", !visible);
          p.classList.toggle("opacity-0", !visible);
          p.classList.toggle("pointer-events-none", !visible);
        });
      }

      btns.forEach((b) => {
        b.addEventListener("click", (e) => {
          e.stopPropagation();
          const key = b.getAttribute("data-menu-button");
          setOpen(open === key ? null : /** @type any */ (key));
        });

        b.addEventListener("keydown", (ev) => {
          if (ev.key === "ArrowDown") {
            ev.preventDefault();
            const key = b.getAttribute("data-menu-button");
            setOpen(/** @type any */ (key));
            const panel = document.querySelector(
              `[data-menu-panel="${key}"] [role="menuitem"]`
            );
            if (panel) (panel).focus();
          }
        });
      });

      document.addEventListener("click", () => setOpen(null));
      document.addEventListener("keydown", (ev) => {
        if (ev.key === "Escape") setOpen(null);
      });

      // Close after clicking a link in any panel
      document.querySelectorAll("[data-close-on-click]").forEach((el) => {
        el.addEventListener("click", () => setOpen(null));
      });

      // Prevent panel click from bubbling (so outside-click works)
      panels.forEach((p) => p.addEventListener("click", (e) => e.stopPropagation()));
    })();
  </script>
</header>

