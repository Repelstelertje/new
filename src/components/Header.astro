---
import { PROVINCES, provinceToSlug } from "../lib/provinces";

const { siteName = "OproepjesNederland" } = Astro.props as {
  siteName?: string;
};

const provinces = [...PROVINCES].sort((a, b) => a.localeCompare(b, "nl"));
---

<header class="bg-white border-b border-neutral-200 text-neutral-900" role="banner">
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600 bg-white px-3 py-2 rounded-md shadow"
  >
    Sla over naar hoofdinhoud
  </a>

  <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-6">
    <!-- Klikbare sitenaam (zonder 18+ badge) -->
    <a href="/" aria-label={`${siteName} homepage`} class="flex items-center gap-3 font-semibold">
      <span class="text-xl">{siteName}</span>
    </a>

    <!-- Navigatie -->
    <nav aria-label="Hoofdnavigatie" class="relative">
      <ul class="flex items-center gap-2">
        <!-- Provincies dropdown -->
        <li class="relative">
          <details class="group" data-menu>
            <summary
              class="cursor-pointer list-none rounded-md px-3 py-2 text-sm font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
              aria-haspopup="menu"
            >
              Provincies
            </summary>
            <div
              role="menu"
              class="absolute right-0 z-20 mt-2 w-[min(92vw,38rem)] rounded-xl border border-neutral-200 bg-white p-3 shadow-lg"
            >
              <ul class="grid grid-cols-2 md:grid-cols-3 gap-1">
                {provinces.map((name) => {
                  const slug = provinceToSlug(name);
                  return (
                    <li>
                      <a
                        role="menuitem"
                        href={`/dating-${slug}/`}
                        class="block rounded-md px-3 py-2 text-sm hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                        aria-label={`Bekijk profielen in ${name}`}
                      >
                        {name}
                      </a>
                    </li>
                  );
                })}
              </ul>
            </div>
          </details>
        </li>

        <!-- Datingtips dropdown (placeholder-links) -->
        <li class="relative">
          <details class="group" data-menu>
            <summary
              class="cursor-pointer list-none rounded-md px-3 py-2 text-sm font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
              aria-haspopup="menu"
            >
              Datingtips
            </summary>
            <div role="menu" class="absolute right-0 z-20 mt-2 w-[min(92vw,28rem)] rounded-xl border border-neutral-200 bg-white p-2 shadow-lg">
              <ul>
                <li>
                  <a role="menuitem" href="/tips/veilig-daten/" class="block rounded-md px-3 py-2 text-sm hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600">
                    Veilig daten (18+)
                  </a>
                </li>
                <li>
                  <a role="menuitem" href="/tips/eerste-bericht/" class="block rounded-md px-3 py-2 text-sm hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600">
                    Het eerste bericht
                  </a>
                </li>
                <li>
                  <a role="menuitem" href="/tips/afspreken/" class="block rounded-md px-3 py-2 text-sm hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600">
                    Afspreken: do’s & don’ts
                  </a>
                </li>
              </ul>
            </div>
          </details>
        </li>

        <!-- Socials dropdown (alleen iconen) -->
        <li class="relative">
          <details class="group" data-menu>
            <summary
              class="cursor-pointer list-none rounded-md px-3 py-2 text-sm font-medium hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
              aria-haspopup="menu"
            >
              Socials
            </summary>
            <div role="menu" class="absolute right-0 z-20 mt-2 rounded-xl border border-neutral-200 bg-white p-2 shadow-lg">
              <ul class="flex items-center gap-3 px-2 py-1">
                <li>
                  <a
                    role="menuitem"
                    href="https://facebook.com/contactoproepjes"
                    target="_blank"
                    rel="noopener nofollow"
                    aria-label="Volg ons op Facebook"
                    class="inline-flex items-center rounded-md p-2 hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                    title="Facebook"
                  >
                    <img src="/img/fb.png" width="22" height="22" alt="" />
                  </a>
                </li>
                <li>
                  <a
                    role="menuitem"
                    href="https://www.instagram.com/oproepjes_nederland"
                    target="_blank"
                    rel="noopener nofollow"
                    aria-label="Volg ons op Instagram"
                    class="inline-flex items-center rounded-md p-2 hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600"
                    title="Instagram"
                  >
                    <img src="/img/ig.png" width="22" height="22" alt="" />
                  </a>
                </li>
              </ul>
            </div>
          </details>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Minimal JS om menu’s netjes te sluiten -->
  <script is:inline>
    (function () {
      const header = document.currentScript.closest('header');
      if (!header) return;

      // Sluit andere menu’s bij openen van één
      header.addEventListener('toggle', (e) => {
        const t = e.target;
        if (!(t instanceof HTMLDetailsElement) || !t.hasAttribute('data-menu')) return;
        if (t.open) {
          header.querySelectorAll('details[data-menu][open]').forEach((d) => {
            if (d !== t) d.removeAttribute('open');
          });
        }
      });

      // Klik buiten -> sluiten
      document.addEventListener('pointerdown', (e) => {
        const openMenus = header.querySelectorAll('details[data-menu][open]');
        openMenus.forEach((d) => {
          if (!d.contains(e.target)) d.removeAttribute('open');
        });
      });

      // ESC -> sluiten
      document.addEventListener('keydown', (e) => {
        if (e.key !== 'Escape') return;
        header.querySelectorAll('details[data-menu][open]').forEach((d) => d.removeAttribute('open'));
      });

      // Na klik op link binnen menu -> sluiten
      header.addEventListener('click', (e) => {
        const a = (e.target as HTMLElement).closest('a');
        if (a && a.closest('details[data-menu]')) {
          header.querySelectorAll('details[data-menu][open]').forEach((d) => d.removeAttribute('open'));
        }
      });
    })();
  </script>
</header>
