---
import PageView from "../../views/PageView.astro";
import { config } from "../../lib/config";
import { getProvince } from "../../lib/api";
import { PROVINCES, provinceToSlug } from "../../lib/provinces";

export async function getStaticPaths() {
  const pageSize = config.api.limits?.pageSize ?? 60;

  const paths = [] as Array<{
    params: { provincie: string };
    props: {
      provinceName: string;
      slug: string;
      currentPage: number;
      totalPages: number;
      totalCount: number;
      profiles: Awaited<ReturnType<typeof getProvince>>["profiles"];
      pageSize: number;
    };
  }>;

  for (const provinceName of PROVINCES) {
    const slug = provinceToSlug(provinceName);
    const firstPage = await getProvince(provinceName, pageSize, 1);
    const totalPages = firstPage.totalPages ?? 1;

    paths.push({
      params: { provincie: slug },
      props: {
        provinceName,
        slug,
        currentPage: 1,
        totalPages,
        totalCount: firstPage.totalCount ?? firstPage.profiles.length,
        profiles: firstPage.profiles,
        pageSize,
      },
    });
  }

  return paths;
}

interface Props {
  provinceName: string;
  slug: string;
  currentPage: number;
  totalPages: number;
  totalCount: number;
  profiles: Awaited<ReturnType<typeof getProvince>>["profiles"];
  pageSize: number;
}

const { provinceName, slug, currentPage, totalPages, totalCount, profiles, pageSize } = Astro.props as Props;
---
<PageView
  provinceName={provinceName}
  slug={slug}
  currentPage={currentPage}
  totalPages={totalPages}
  pageSize={pageSize}
  totalCount={totalCount}
  profiles={profiles}
/>
